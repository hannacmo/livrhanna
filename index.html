<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>livrhanna</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:        #F4F0E4;
    --teal:      #44A194;
    --teal-dark: #358078;
    --teal-pale: #d4efec;
    --blue:      #537D96;
    --blue-dark: #3f617a;
    --blue-pale: #d6e5ef;
    --pink:      #EC8F8D;
    --pink-dark: #d4706e;
    --pink-pale: #fce8e8;
    --ink:       #2a2a2a;
    --mid:       #6b6b6b;
    --light:     #e8e4d8;
    --white:     #ffffff;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--ink);
    min-height: 100vh;
    font-size: 15px;
    text-transform: lowercase;
  }

  .book-title, .pub-title,
  .book-author, .pub-author,
  .modal-book-title, .modal-book-author,
  .res-name { text-transform: none !important; }
  input, textarea, select { text-transform: none; }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LOADING SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  #loading-screen {
    position: fixed; inset: 0; background: var(--teal);
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    z-index: 999; transition: opacity .4s;
  }

  #loading-screen.hidden { opacity: 0; pointer-events: none; }

  .loading-logo {
    font-family: 'Playfair Display', serif;
    font-size: 3rem; color: white; font-style: italic;
    margin-bottom: 20px;
  }

  .spinner {
    width: 36px; height: 36px; border: 3px solid rgba(255,255,255,.3);
    border-top-color: white; border-radius: 50%;
    animation: spin .8s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HERO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  .hero {
    background: var(--teal);
    padding: 48px 36px 36px;
    text-align: center;
  }

  .logo {
    font-family: 'Playfair Display', serif;
    font-size: 2.8rem; color: var(--white);
    font-style: italic; display: block;
    margin-bottom: 10px; text-transform: lowercase;
  }

  .hero p {
    font-size: .97rem; color: rgba(255,255,255,.75);
    max-width: 500px; margin: 0 auto 24px; line-height: 1.65;
  }

  .hero-search { max-width: 400px; margin: 0 auto 18px; position: relative; }

  .hero-search input {
    width: 100%; padding: 11px 18px 11px 40px;
    border: 2px solid rgba(255,255,255,.22); border-radius: 24px;
    background: rgba(255,255,255,.14); color: white;
    font-family: 'DM Sans', sans-serif; font-size: .93rem;
    transition: all .2s; text-transform: none;
  }

  .hero-search input::placeholder { color: rgba(255,255,255,.48); }
  .hero-search input:focus { outline: none; background: rgba(255,255,255,.22); border-color: rgba(255,255,255,.6); }
  .hero-search::before { content: 'üîç'; position: absolute; left: 13px; top: 50%; transform: translateY(-50%); }

  .hero-tabs {
    display: flex; justify-content: center; gap: 7px;
    flex-wrap: wrap; margin-bottom: 18px;
  }

  .hero-tab {
    padding: 6px 15px; border: 1.5px solid rgba(255,255,255,.28);
    border-radius: 20px; background: transparent;
    color: rgba(255,255,255,.7); font-family: 'DM Sans', sans-serif;
    font-size: .77rem; font-weight: 500; cursor: pointer; transition: all .2s;
  }

  .hero-tab:hover { background: rgba(255,255,255,.12); color: white; }
  .hero-tab.active { background: white; color: var(--teal); font-weight: 700; border-color: white; }

  .hero-stats { display: flex; justify-content: center; gap: 28px; }
  .hstat { font-size: .75rem; color: rgba(255,255,255,.68); }
  .hstat strong { font-family: 'Playfair Display', serif; font-size: 1.25rem; color: var(--white); display: block; line-height: 1.2; }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CONTAINER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  .container { max-width: 1100px; margin: 0 auto; padding: 30px 28px; }

  .toolbar {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 20px; gap: 12px; flex-wrap: wrap;
  }

  .section-label { font-size: .7rem; color: var(--mid); letter-spacing: .1em; }

  .btn-add {
    padding: 9px 20px; background: var(--teal); border: none;
    border-radius: 20px; font-family: 'DM Sans', sans-serif;
    font-size: .82rem; font-weight: 700; color: white;
    cursor: pointer; transition: background .2s;
  }

  .btn-add:hover { background: var(--teal-dark); }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BOOK GRID ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  .books-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(210px, 1fr)); gap: 18px; }

  .book-card {
    background: var(--white); border-radius: 10px;
    box-shadow: 0 2px 12px rgba(0,0,0,.07);
    overflow: hidden; transition: transform .22s, box-shadow .22s;
    animation: fadeUp .3s ease both;
    display: flex; flex-direction: column;
    border: 1.5px solid var(--light); position: relative;
  }

  @keyframes fadeUp { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

  .book-card:hover { transform: translateY(-5px); box-shadow: 0 10px 26px rgba(0,0,0,.12); }
  .book-card.is-reserved { border-color: rgba(68,161,148,.3); }

  .card-admin { position: absolute; top: 8px; right: 8px; display: none; gap: 5px; z-index: 10; }
  body.admin-unlocked .card-admin { display: flex; }

  .card-btn {
    width: 28px; height: 28px; border-radius: 50%; border: none; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: .78rem; transition: all .15s; box-shadow: 0 1px 4px rgba(0,0,0,.2);
  }

  .card-btn.edit { background: white; color: var(--blue); }
  .card-btn.del  { background: white; color: var(--pink-dark); }
  .card-btn.edit:hover { background: var(--blue);     color: white; }
  .card-btn.del:hover  { background: var(--pink-dark); color: white; }

  .book-cover {
    width: 100%; height: 170px; overflow: hidden;
    display: flex; align-items: center; justify-content: center;
    font-size: 3.5rem; background: var(--light);
    position: relative; flex-shrink: 0;
  }

  .book-cover img { width:100%; height:100%; object-fit:cover; position:absolute; inset:0; }
  .cover-emoji { position: relative; z-index: 1; }

  .book-ribbon {
    position: absolute; bottom: 0; left: 0; right: 0;
    padding: 5px 10px;
    background: linear-gradient(transparent, rgba(0,0,0,.45));
    display: flex; gap: 4px; flex-wrap: wrap; z-index: 2;
  }

  .ribbon-tag {
    font-size: .58rem; padding: 2px 7px; border-radius: 10px;
    background: rgba(255,255,255,.22); color: white;
    backdrop-filter: blur(4px); font-weight: 600; letter-spacing: .04em;
  }

  .reserved-overlay {
    position: absolute; inset: 0; background: rgba(83,125,150,.38);
    display: flex; align-items: center; justify-content: center; z-index: 3;
  }

  .reserved-stamp {
    border: 2.5px solid white; color: white;
    font-family: 'Playfair Display', serif; font-size: .88rem; font-weight: 700;
    padding: 4px 14px; letter-spacing: .1em; transform: rotate(-12deg);
  }

  .donate-badge {
    position: absolute; top: 8px; left: 8px; z-index: 4;
    font-size: .58rem; padding: 3px 8px; border-radius: 10px;
    background: var(--teal); color: white; font-weight: 700;
  }

  .book-body { padding: 13px 14px 0; flex: 1; }
  .pub-title  { font-family: 'Playfair Display', serif; font-size: 1rem; font-weight: 700; line-height: 1.35; margin-bottom: 2px; color: var(--ink); }
  .pub-author { font-size: .78rem; color: var(--mid); font-style: italic; margin-bottom: 8px; }

  .book-meta { display: flex; flex-wrap: wrap; gap: 3px; margin-bottom: 8px; }

  .meta-tag {
    font-size: .6rem; padding: 2px 7px; border-radius: 10px;
    background: var(--light); color: var(--mid); font-weight: 500;
  }

  .book-rating { color: var(--pink); font-size: .78rem; margin-bottom: 6px; }

  .reserved-by {
    display: flex; align-items: center; gap: 7px;
    background: var(--teal-pale); border-radius: 6px;
    padding: 7px 10px; margin-bottom: 8px;
    font-size: .79rem; color: var(--teal-dark);
  }

  .avatar {
    width: 26px; height: 26px; border-radius: 50%;
    background: var(--teal); color: white;
    display: flex; align-items: center; justify-content: center;
    font-family: 'Playfair Display', serif; font-weight: 700;
    font-size: .78rem; flex-shrink: 0; text-transform: uppercase;
  }

  .res-label { font-size: .66rem; color: var(--teal); display: block; opacity: .75; }

  .book-footer { padding: 0 14px 14px; margin-top: auto; padding-top: 4px; }

  .btn-quero {
    width: 100%; padding: 9px; background: var(--teal); border: none;
    border-radius: 8px; font-family: 'DM Sans', sans-serif; font-size: .9rem;
    font-weight: 700; color: white; cursor: pointer; transition: background .2s;
  }

  .btn-quero:hover { background: var(--teal-dark); }

  .btn-cancelar {
    width: 100%; padding: 7px; background: transparent;
    border: 1.5px solid var(--light); border-radius: 8px;
    font-size: .72rem; color: var(--mid); cursor: pointer;
    transition: all .15s; margin-top: 5px; font-family: 'DM Sans', sans-serif;
  }

  .btn-cancelar:hover { border-color: var(--pink); color: var(--pink-dark); }

  .book-notes { font-size: .72rem; color: var(--mid); font-style: italic; padding: 0 14px 10px; line-height: 1.4; }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EMPTY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  .empty-state { text-align: center; padding: 70px 20px; color: var(--mid); }
  .empty-state .icon { font-size: 3.5rem; margin-bottom: 14px; }
  .empty-state h3 { font-family: 'Playfair Display', serif; font-size: 1.3rem; margin-bottom: 7px; color: var(--ink); }
  .empty-state p  { font-size: .87rem; }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODALS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  .modal-overlay {
    display: none; position: fixed; inset: 0;
    background: rgba(42,42,42,.55); z-index: 200;
    align-items: center; justify-content: center;
    padding: 20px; backdrop-filter: blur(4px);
  }

  .modal-overlay.show { display: flex; }

  .modal {
    background: var(--bg); border-radius: 14px;
    width: 100%; max-width: 480px; max-height: 92vh;
    overflow-y: auto; box-shadow: 0 24px 60px rgba(0,0,0,.18);
    animation: slideUp .26s cubic-bezier(.22,1,.36,1);
  }

  @keyframes slideUp { from { opacity:0; transform:translateY(24px) scale(.97); } to { opacity:1; transform:translateY(0) scale(1); } }

  .modal-header {
    padding: 20px 22px 14px; border-bottom: 1px solid var(--light);
    display: flex; justify-content: space-between; align-items: flex-start;
  }

  .modal-header h2 { font-family: 'Playfair Display', serif; font-size: 1.25rem; color: var(--ink); }
  .modal-header p  { font-size: .77rem; color: var(--mid); margin-top: 2px; }
  .modal-close { background: none; border: none; font-size: 1.2rem; cursor: pointer; color: var(--mid); }

  .modal-book-preview {
    display: flex; align-items: center; gap: 12px;
    padding: 12px 22px; background: var(--light);
    border-bottom: 1px solid rgba(0,0,0,.05);
  }

  .modal-book-icon {
    width: 52px; height: 52px; border-radius: 6px; overflow: hidden; flex-shrink: 0;
    display: flex; align-items: center; justify-content: center; font-size: 1.8rem;
  }

  .modal-book-icon img { width:100%; height:100%; object-fit:cover; }
  .modal-book-title  { font-family:'Playfair Display',serif; font-size:.93rem; font-weight:700; color:var(--ink); }
  .modal-book-author { font-size:.76rem; color:var(--mid); font-style:italic; }

  .modal-body { padding: 18px 22px; }

  .form-group { margin-bottom: 13px; }

  .form-group label {
    display: block; font-size: .71rem; color: var(--mid);
    margin-bottom: 5px; font-weight: 700; letter-spacing: .04em;
  }

  .form-group input, .form-group select, .form-group textarea {
    width: 100%; padding: 9px 11px; border: 1.5px solid var(--light); border-radius: 8px;
    background: var(--white); font-family: 'DM Sans', sans-serif; font-size: .87rem;
    color: var(--ink); transition: border-color .2s; text-transform: none;
  }

  .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--teal); }

  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

  .checkbox-group { display: flex; gap: 14px; flex-wrap: wrap; }
  .checkbox-label { display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: .8rem; color: var(--mid); }

  .cover-upload-area {
    border: 2px dashed var(--light); border-radius: 8px;
    padding: 14px; text-align: center; cursor: pointer;
    transition: all .2s; position: relative; overflow: hidden;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    gap: 4px; min-height: 72px;
  }

  .cover-upload-area:hover { border-color: var(--teal); background: var(--teal-pale); }
  .cover-upload-area input { position:absolute; inset:0; opacity:0; cursor:pointer; width:100%; height:100%; }
  .cover-upload-area .upload-icon { font-size: 1.6rem; }
  .cover-upload-area p { font-size: .75rem; color: var(--mid); }
  .cover-upload-area img.preview { width:100%; max-height:130px; object-fit:cover; border-radius:6px; }

  .modal-footer { padding: 4px 22px 20px; }

  .btn-save {
    width: 100%; padding: 11px; background: var(--teal); border: none; border-radius: 8px;
    font-family: 'DM Sans', sans-serif; font-size: .95rem; font-weight: 700; color: white;
    cursor: pointer; transition: background .2s;
  }

  .btn-save:hover { background: var(--teal-dark); }
  .btn-save:disabled { opacity: .6; cursor: wait; }

  .btn-cancel-sm {
    width: 100%; padding: 8px; margin-top: 7px;
    background: transparent; border: 1.5px solid var(--light); border-radius: 8px;
    font-family: 'DM Sans', sans-serif; color: var(--mid);
    cursor: pointer; font-size: .82rem; transition: all .2s;
  }

  .btn-cancel-sm:hover { border-color: var(--mid); }

  .privacy-note { text-align: center; font-size: .7rem; color: var(--mid); margin-top: 8px; font-style: italic; }

  /* password modal */
  .pass-body { padding: 30px 26px 24px; text-align: center; }
  .pass-body .lock-icon { font-size: 2.5rem; margin-bottom: 10px; }
  .pass-body h2 { font-family:'Playfair Display',serif; font-size:1.25rem; margin-bottom:6px; color:var(--ink); }
  .pass-body p  { font-size:.82rem; color:var(--mid); margin-bottom:18px; }
  .pass-input-wrap { position: relative; margin-bottom: 12px; }
  .pass-input-wrap input { font-size: 1rem; letter-spacing: .12em; text-align: center; padding-right: 38px; }
  .pass-eye { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: .95rem; color: var(--mid); }
  .pass-error { font-size: .78rem; color: var(--pink-dark); margin-bottom: 10px; min-height: 18px; }

  /* success */
  .success-body { padding: 28px 22px 24px; text-align: center; }
  .success-icon { font-size: 3.2rem; margin-bottom: 12px; }
  .success-body h3 { font-family:'Playfair Display',serif; font-size:1.3rem; color:var(--teal); margin-bottom:8px; }
  .success-body p  { font-size:.86rem; color:var(--mid); line-height:1.6; }
  .btn-fechar { margin-top: 18px; padding: 10px 28px; background: var(--teal); border: none; border-radius: 8px; color: white; font-family: 'DM Sans', sans-serif; font-size: .9rem; font-weight: 700; cursor: pointer; transition: background .2s; }
  .btn-fechar:hover { background: var(--teal-dark); }

  /* toast */
  .toast { position: fixed; bottom: 24px; right: 24px; background: var(--ink); color: white; padding: 10px 18px; border-radius: 8px; font-size: .86rem; transform: translateY(70px); opacity: 0; transition: all .3s; z-index: 300; border-left: 3px solid var(--teal); max-width: 280px; }
  .toast.show { transform: translateY(0); opacity: 1; }

  /* admin bar */
  .admin-bar { display: none; background: var(--ink); padding: 8px 28px; align-items: center; justify-content: space-between; gap: 10px; }
  .admin-bar.on { display: flex; }
  .admin-bar span { font-size: .76rem; color: rgba(255,255,255,.6); }
  .admin-bar span em { color: var(--teal); font-style: normal; }
  .btn-exit-admin { padding: 5px 14px; background: transparent; border: 1px solid rgba(255,255,255,.2); border-radius: 20px; font-size: .74rem; color: rgba(255,255,255,.5); cursor: pointer; transition: all .2s; font-family: 'DM Sans', sans-serif; }
  .btn-exit-admin:hover { border-color: rgba(255,255,255,.5); color: white; }

  /* firebase config warning */
  .config-warning {
    background: var(--pink-pale); border: 2px solid var(--pink);
    border-radius: 10px; padding: 20px 24px; margin: 30px auto;
    max-width: 600px; text-align: center;
  }
  .config-warning h3 { font-family:'Playfair Display',serif; color:var(--pink-dark); margin-bottom:8px; font-size:1.1rem; }
  .config-warning p  { font-size:.85rem; color:var(--ink); line-height:1.6; }
  .config-warning code { background: rgba(236,143,141,.2); padding: 2px 6px; border-radius:4px; font-family:monospace; font-size:.82rem; }

  @media (max-width: 640px) {
    .hero { padding: 36px 18px 28px; }
    .container { padding: 20px 14px; }
    .books-grid { grid-template-columns: 1fr 1fr; gap: 10px; }
    .form-row { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<!-- LOADING -->
<div id="loading-screen">
  <div class="loading-logo">livrhanna</div>
  <div class="spinner"></div>
</div>

<!-- HERO -->
<div class="hero">
  <span class="logo">livrhanna</span>
  <p>os livros da minha estante ‚Äî os marcados com üíö est√£o dispon√≠veis para doa√ß√£o. clique em <strong style="color:white;">"eu quero!"</strong> para reservar.</p>
  <div class="hero-search">
    <input type="text" id="search" placeholder="buscar por t√≠tulo ou autor..." oninput="render()">
  </div>
  <div class="hero-tabs">
    <button class="hero-tab active" onclick="setTab('all', this)">todos</button>
    <button class="hero-tab" onclick="setTab('donate', this)">para doa√ß√£o</button>
    <button class="hero-tab" onclick="setTab('read', this)">lidos</button>
    <button class="hero-tab" onclick="setTab('wishlist', this)">wishlist</button>
  </div>
  <div class="hero-stats">
    <div class="hstat"><strong id="stat-total">0</strong>na estante</div>
    <div class="hstat"><strong id="stat-donate">0</strong>para doa√ß√£o</div>
    <div class="hstat"><strong id="stat-reserved">0</strong>reservados</div>
  </div>
</div>

<!-- ADMIN BAR -->
<div class="admin-bar" id="admin-bar">
  <span>‚úèÔ∏è modo admin <em>ativado</em> ‚Äî somente voc√™ est√° vendo isso</span>
  <button class="btn-exit-admin" onclick="exitAdmin()">sair</button>
</div>

<!-- CONTENT -->
<div class="container">
  <div class="toolbar">
    <div class="section-label" id="section-label">carregando...</div>
    <button class="btn-add" onclick="clickAdd()">Ôºã adicionar livro</button>
  </div>
  <div id="config-warning-area"></div>
  <div class="books-grid" id="books-grid"></div>
  <div class="empty-state" id="empty-state" style="display:none;">
    <div class="icon">üìö</div>
    <h3>nenhum livro encontrado</h3>
    <p>tente buscar por outro t√≠tulo ou ajuste o filtro.</p>
  </div>
</div>

<!-- MODAL: SENHA -->
<div class="modal-overlay" id="pass-modal">
  <div class="modal" style="max-width:360px;">
    <div class="pass-body">
      <div class="lock-icon">üîê</div>
      <h2>√°rea restrita</h2>
      <p>apenas hanna pode adicionar livros.<br>digite a senha para continuar.</p>
      <div class="pass-input-wrap">
        <input type="password" id="pass-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeydown="if(event.key==='Enter')checkPass()">
        <button class="pass-eye" onclick="togglePassVis()">üëÅ</button>
      </div>
      <p class="pass-error" id="pass-error"></p>
      <button class="btn-save" onclick="checkPass()">entrar</button>
      <button class="btn-cancel-sm" onclick="closePassModal()">cancelar</button>
    </div>
  </div>
</div>

<!-- MODAL: ADICIONAR / EDITAR -->
<div class="modal-overlay" id="book-modal">
  <div class="modal">
    <div class="modal-header">
      <h2 id="book-modal-title">novo livro</h2>
      <button class="modal-close" onclick="closeBookModal()">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>foto da capa</label>
        <div class="cover-upload-area" id="cover-area">
          <input type="file" accept="image/*" onchange="handleCover(event)">
          <div id="cover-content">
            <div class="upload-icon">üì∑</div>
            <p>clique para adicionar uma foto</p>
          </div>
        </div>
      </div>
      <div class="form-group"><label>t√≠tulo *</label><input type="text" id="f-title" placeholder="ex: o alquimista"></div>
      <div class="form-group"><label>autor *</label><input type="text" id="f-author" placeholder="ex: paulo coelho"></div>
      <div class="form-row">
        <div class="form-group">
          <label>g√™nero</label>
          <select id="f-genre">
            <option value="">selecionar...</option>
            <option>Romance</option><option>Fic√ß√£o Cient√≠fica</option><option>Fantasia</option>
            <option>Terror</option><option>Mist√©rio</option><option>Thriller</option>
            <option>N√£o-fic√ß√£o</option><option>Biografia</option><option>Hist√≥ria</option>
            <option>Filosofia</option><option>Autoajuda</option><option>Cl√°ssico</option>
            <option>Literatura Brasileira</option><option>Infantil</option>
            <option>HQ / Graphic Novel</option><option>Outro</option>
          </select>
        </div>
        <div class="form-group">
          <label>ano</label>
          <input type="number" id="f-year" placeholder="ex: 2001" min="1000" max="2100">
        </div>
      </div>
      <div class="form-group">
        <label>avalia√ß√£o</label>
        <select id="f-rating">
          <option value="0">sem avalia√ß√£o</option>
          <option value="1">‚≠ê</option><option value="2">‚≠ê‚≠ê</option>
          <option value="3">‚≠ê‚≠ê‚≠ê</option><option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option>
          <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
        </select>
      </div>
      <div class="form-group">
        <label>observa√ß√µes</label>
        <textarea id="f-notes" rows="2" placeholder="estado do livro, edi√ß√£o especial..."></textarea>
      </div>
      <div class="form-group">
        <label>marcadores</label>
        <div class="checkbox-group">
          <label class="checkbox-label"><input type="checkbox" id="f-donate"> üíö para doa√ß√£o</label>
          <label class="checkbox-label"><input type="checkbox" id="f-read"> ‚úÖ lido</label>
          <label class="checkbox-label"><input type="checkbox" id="f-wishlist"> üîµ wishlist</label>
          <label class="checkbox-label"><input type="checkbox" id="f-duplicate"> üî¥ repetido</label>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-save" id="btn-save-book" onclick="saveBook()">salvar livro</button>
      <button class="btn-cancel-sm" onclick="closeBookModal()">cancelar</button>
    </div>
  </div>
</div>

<!-- MODAL: RESERVAR -->
<div class="modal-overlay" id="reserve-modal">
  <div class="modal" id="reserve-inner"></div>
</div>

<div class="toast" id="toast"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     FIREBASE SDK
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script type="module">
  import { initializeApp }                       from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js';
  import { getFirestore, collection, doc,
           onSnapshot, addDoc, setDoc,
           deleteDoc, updateDoc, serverTimestamp }
         from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js';
  import { getStorage, ref, uploadString,
           getDownloadURL, deleteObject }
         from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js';

  // ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
  //  üî• COLE AQUI AS SUAS CONFIGURA√á√ïES DO FIREBASE
  //     (voc√™ vai obter esses valores no passo 4 do tutorial)
  // ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
  const firebaseConfig = {
    apiKey:            "AIzaSyDwC33fFGoeYJbq6xtoWiIHB3yYYa4hUF0",
    authDomain:        "livrhanna.firebaseapp.com",
    projectId:         "livrhanna",
    storageBucket:     "livrhanna.firebasestorage.app",
    messagingSenderId: "555806722861",
    appId:             "1:555806722861:web:f393ee4eb96e4910fb61a4"
  };
  // ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

  const CONFIGURED = firebaseConfig.apiKey !== "COLE_AQUI";

  // ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
  //  üîë MUDE A SENHA
  const SENHA = 'V0lp4t45';
  // ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

  let db, storage;
  let books        = [];
  let reservations = {};
  let isAdmin      = false;
  let editingId    = null;
  let reservingId  = null;
  let pendingCover = null; // base64
  let currentTab   = 'all';

  const BG = ['#d4efec','#d6e5ef','#fce8e8','#e4d4ef','#d4e8d4','#f0e8d4','#e8d4d4'];
  const EM = {
    'Romance':'üíï','Fic√ß√£o Cient√≠fica':'üöÄ','Fantasia':'üßô','Terror':'üëª','Mist√©rio':'üïµÔ∏è',
    'Thriller':'üî™','N√£o-fic√ß√£o':'üìä','Biografia':'üë§','Hist√≥ria':'üèõÔ∏è','Filosofia':'ü§î',
    'Autoajuda':'üí™','Cl√°ssico':'üèÜ','Literatura Brasileira':'üåø','Infantil':'üåà','HQ / Graphic Novel':'ü¶∏'
  };

  const bgColor  = t => BG[Math.abs((t||'').split('').reduce((s,c)=>s+c.charCodeAt(0),0)) % BG.length];
  const bookEmoji= g => EM[g] || 'üìñ';
  const inits    = n => (n||'').trim().split(' ').filter(Boolean).slice(0,2).map(p=>p[0].toUpperCase()).join('');
  const esc      = s => (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  const genId    = () => Date.now().toString(36) + Math.random().toString(36).substr(2);

  function showToast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg; t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 2800);
  }

  function hideLoading() {
    const s = document.getElementById('loading-screen');
    s.classList.add('hidden');
    setTimeout(() => s.style.display = 'none', 500);
  }

  // ‚îÄ‚îÄ FIREBASE INIT ‚îÄ‚îÄ
  if (!CONFIGURED) {
    // Show warning and fallback to localStorage
    document.getElementById('config-warning-area').innerHTML = `
      <div class="config-warning">
        <h3>‚ö†Ô∏è firebase ainda n√£o configurado</h3>
        <p>o app est√° funcionando com armazenamento local (s√≥ voc√™ v√™ os dados).<br>
        siga o tutorial abaixo para conectar ao firebase e os dados passar√£o a ser compartilhados com todos.
        <br><br>quando tiver as configura√ß√µes, cole-as no arquivo onde est√° escrito <code>COLE_AQUI</code>.</p>
      </div>`;
    loadLocalFallback();
    hideLoading();
  } else {
    const app = initializeApp(firebaseConfig);
    db      = getFirestore(app);
    storage = getStorage(app);

    // Listen to books in real-time
    onSnapshot(collection(db, 'books'), snap => {
      books = snap.docs.map(d => ({ id: d.id, ...d.data() }));
      books.sort((a,b) => (a.added||0) - (b.added||0));
      render();
    });

    // Listen to reservations in real-time
    onSnapshot(collection(db, 'reservations'), snap => {
      reservations = {};
      snap.docs.forEach(d => { reservations[d.id] = d.data(); });
      render();
    });

    hideLoading();
  }

  // ‚îÄ‚îÄ LOCAL FALLBACK (sem firebase) ‚îÄ‚îÄ
  function loadLocalFallback() {
    try { books        = JSON.parse(localStorage.getItem('livrhanna_books')   || '[]'); } catch(e) { books=[]; }
    try { const r      = JSON.parse(localStorage.getItem('livrhanna_reservas') || '{}');
          reservations = r; } catch(e) { reservations={}; }
    if (!books.length) seedLocal();
    render();
  }

  function seedLocal() {
    const s = [
      { title:'O Alquimista', author:'Paulo Coelho', genre:'Romance', year:'1988', rating:3, read:true, donate:true, duplicate:false, wishlist:false, notes:'', cover:null },
      { title:'Sapiens', author:'Yuval Noah Harari', genre:'N√£o-fic√ß√£o', year:'2011', rating:4, read:true, donate:true, duplicate:false, wishlist:false, notes:'', cover:null },
      { title:'Dom Casmurro', author:'Machado de Assis', genre:'Cl√°ssico', year:'1899', rating:5, read:true, donate:false, duplicate:false, wishlist:false, notes:'', cover:null },
    ];
    s.forEach(b => books.push({ id:genId(), added:Date.now(), ...b }));
    localStorage.setItem('livrhanna_books', JSON.stringify(books));
  }

  function saveLocal() {
    localStorage.setItem('livrhanna_books',   JSON.stringify(books));
    localStorage.setItem('livrhanna_reservas', JSON.stringify(reservations));
  }

  // ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ
  window.clickAdd = () => {
    if (isAdmin) { openBookModal(); return; }
    document.getElementById('pass-input').value = '';
    document.getElementById('pass-error').textContent = '';
    document.getElementById('pass-modal').classList.add('show');
    setTimeout(() => document.getElementById('pass-input').focus(), 120);
  };

  window.closePassModal = () => document.getElementById('pass-modal').classList.remove('show');

  window.checkPass = () => {
    const val = document.getElementById('pass-input').value;
    if (val === SENHA) {
      isAdmin = true;
      window.closePassModal();
      document.getElementById('admin-bar').classList.add('on');
      document.body.classList.add('admin-unlocked');
      render();
      openBookModal();
    } else {
      document.getElementById('pass-error').textContent = 'senha incorreta, tente novamente.';
      document.getElementById('pass-input').value = '';
      document.getElementById('pass-input').animate(
        [{transform:'translateX(-6px)'},{transform:'translateX(6px)'},{transform:'translateX(0)'}],
        {duration:240}
      );
      document.getElementById('pass-input').focus();
    }
  };

  window.exitAdmin = () => {
    isAdmin = false;
    document.getElementById('admin-bar').classList.remove('on');
    document.body.classList.remove('admin-unlocked');
    render();
    showToast('saiu do modo admin.');
  };

  window.togglePassVis = () => {
    const i = document.getElementById('pass-input');
    i.type = i.type === 'password' ? 'text' : 'password';
  };

  // ‚îÄ‚îÄ BOOK MODAL ‚îÄ‚îÄ
  function openBookModal(id) {
    editingId    = id || null;
    pendingCover = null;
    const b = id ? books.find(b=>b.id===id) : null;

    document.getElementById('book-modal-title').textContent = b ? 'editar livro' : 'novo livro';
    document.getElementById('f-title').value     = b ? b.title      : '';
    document.getElementById('f-author').value    = b ? b.author     : '';
    document.getElementById('f-genre').value     = b ? (b.genre||'')    : '';
    document.getElementById('f-year').value      = b ? (b.year||'')     : '';
    document.getElementById('f-rating').value    = b ? (b.rating||0)    : 0;
    document.getElementById('f-notes').value     = b ? (b.notes||'')    : '';
    document.getElementById('f-donate').checked    = b ? !!b.donate    : true;
    document.getElementById('f-read').checked      = b ? !!b.read      : false;
    document.getElementById('f-wishlist').checked  = b ? !!b.wishlist  : false;
    document.getElementById('f-duplicate').checked = b ? !!b.duplicate : false;

    const cc = document.getElementById('cover-content');
    if (b && b.coverUrl) {
      cc.innerHTML = `<img class="preview" src="${esc(b.coverUrl)}"><p style="font-size:.72rem;color:var(--teal);margin-top:4px;">‚úì foto atual ‚Äî clique para trocar</p>`;
    } else {
      cc.innerHTML = `<div class="upload-icon">üì∑</div><p>clique para adicionar uma foto</p>`;
    }

    document.getElementById('book-modal').classList.add('show');
    setTimeout(() => document.getElementById('f-title').focus(), 100);
  }

  window.closeBookModal = () => {
    document.getElementById('book-modal').classList.remove('show');
    editingId = pendingCover = null;
  };

  window.handleCover = e => {
    const file = e.target.files[0]; if (!file) return;
    const r = new FileReader();
    r.onload = ev => {
      pendingCover = ev.target.result;
      document.getElementById('cover-content').innerHTML =
        `<img class="preview" src="${pendingCover}"><p style="font-size:.72rem;color:var(--teal);margin-top:4px;">‚úì foto carregada ‚Äî clique para trocar</p>`;
    };
    r.readAsDataURL(file);
  };

  window.saveBook = async () => {
    const title  = document.getElementById('f-title').value.trim();
    const author = document.getElementById('f-author').value.trim();
    if (!title)  { showToast('preencha o t√≠tulo!');  return; }
    if (!author) { showToast('preencha o autor!'); return; }

    const btn = document.getElementById('btn-save-book');
    btn.disabled = true;
    btn.textContent = 'salvando...';

    const ex = editingId ? books.find(b=>b.id===editingId) : null;

    let coverUrl = ex ? (ex.coverUrl || null) : null;

    // Upload image to Firebase Storage if new cover selected
    if (pendingCover && CONFIGURED) {
      try {
        const imgRef = ref(storage, `covers/${editingId || genId()}.jpg`);
        await uploadString(imgRef, pendingCover, 'data_url');
        coverUrl = await getDownloadURL(imgRef);
      } catch(err) {
        console.warn('upload failed, using base64 fallback', err);
        coverUrl = pendingCover; // fallback
      }
    } else if (pendingCover) {
      coverUrl = pendingCover; // local fallback
    }

    const bookData = {
      title, author,
      genre:     document.getElementById('f-genre').value,
      year:      document.getElementById('f-year').value,
      rating:    parseInt(document.getElementById('f-rating').value),
      notes:     document.getElementById('f-notes').value.trim(),
      donate:    document.getElementById('f-donate').checked,
      read:      document.getElementById('f-read').checked,
      wishlist:  document.getElementById('f-wishlist').checked,
      duplicate: document.getElementById('f-duplicate').checked,
      coverUrl,
      added:     ex ? ex.added : Date.now()
    };

    try {
      if (CONFIGURED) {
        if (editingId) {
          await setDoc(doc(db, 'books', editingId), bookData);
        } else {
          await addDoc(collection(db, 'books'), bookData);
        }
      } else {
        // local fallback
        if (editingId) {
          const idx = books.findIndex(b=>b.id===editingId);
          books[idx] = { id:editingId, ...bookData };
        } else {
          books.push({ id:genId(), ...bookData });
        }
        saveLocal();
        render();
      }
      showToast(editingId ? 'livro atualizado! ‚úì' : 'livro adicionado! ‚úì');
      window.closeBookModal();
    } catch(err) {
      showToast('erro ao salvar. tente novamente.');
      console.error(err);
    }

    btn.disabled = false;
    btn.textContent = 'salvar livro';
  };

  window.deleteBook = async id => {
    const b = books.find(b=>b.id===id);
    if (!b || !confirm(`remover "${b.title}"?`)) return;

    if (CONFIGURED) {
      await deleteDoc(doc(db, 'books', id));
      await deleteDoc(doc(db, 'reservations', id)).catch(()=>{});
      // delete image from storage if exists
      if (b.coverUrl && b.coverUrl.includes('firebasestorage')) {
        try { await deleteObject(ref(storage, `covers/${id}.jpg`)); } catch(e){}
      }
    } else {
      books = books.filter(b=>b.id!==id);
      delete reservations[id];
      saveLocal();
      render();
    }
    showToast('livro removido.');
  };

  // ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ
  window.setTab = (tab, btn) => {
    currentTab = tab;
    document.querySelectorAll('.hero-tab').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    render();
  };

  function render() {
    const q = (document.getElementById('search').value||'').toLowerCase();

    const list = books.filter(b => {
      const ms = !q || b.title.toLowerCase().includes(q) || b.author.toLowerCase().includes(q);
      const mt = currentTab==='all'      ? true
               : currentTab==='donate'   ? b.donate
               : currentTab==='read'     ? b.read
               : currentTab==='wishlist' ? b.wishlist : true;
      return ms && mt;
    });

    document.getElementById('stat-total').textContent   = books.length;
    document.getElementById('stat-donate').textContent  = books.filter(b=>b.donate).length;
    document.getElementById('stat-reserved').textContent= books.filter(b=>reservations[b.id]).length;

    const lbl = document.getElementById('section-label');
    lbl.textContent = q ? `resultados para "${q}"` : `${list.length} livro${list.length!==1?'s':''}`;

    const grid  = document.getElementById('books-grid');
    const empty = document.getElementById('empty-state');

    if (!list.length) { grid.innerHTML=''; empty.style.display='block'; return; }
    empty.style.display='none';

    grid.innerHTML = list.map((b, i) => {
      const res    = reservations[b.id];
      const bg     = bgColor(b.title);
      const stars  = b.rating ? '‚≠ê'.repeat(b.rating) : '';

      const coverInner = b.coverUrl
        ? `<img src="${esc(b.coverUrl)}" alt="${esc(b.title)}">`
        : `<span class="cover-emoji">${bookEmoji(b.genre)}</span>`;

      const ribbonTags = [
        b.genre && `<span class="ribbon-tag">${esc(b.genre)}</span>`,
        b.year  && `<span class="ribbon-tag">${b.year}</span>`,
      ].filter(Boolean).join('');

      const reservedOver = res ? `<div class="reserved-overlay"><div class="reserved-stamp">reservado</div></div>` : '';
      const donateBadge  = b.donate ? `<span class="donate-badge">üíö doa√ß√£o</span>` : '';

      const reservedBy = res ? `
        <div class="reserved-by">
          <div class="avatar">${inits(res.name)}</div>
          <div><span class="res-label">reservado por</span><span class="res-name"> ${esc(res.name)}</span></div>
        </div>` : '';

      const adminBtns = `
        <div class="card-admin">
          <button class="card-btn edit" onclick="window._editBook('${b.id}')" title="editar">‚úèÔ∏è</button>
          <button class="card-btn del"  onclick="window.deleteBook('${b.id}')" title="remover">üóëÔ∏è</button>
        </div>`;

      let footer = '';
      if (b.donate) {
        footer = !res
          ? `<div class="book-footer"><button class="btn-quero" onclick="window._openReserve('${b.id}')">üíö eu quero!</button></div>`
          : `<div class="book-footer"><button class="btn-cancelar" onclick="window._cancelReserve('${b.id}')">cancelar reserva</button></div>`;
      }

      const notes = b.notes ? `<div class="book-notes">${esc(b.notes)}</div>` : '';

      return `
        <div class="book-card${res?' is-reserved':''}" style="animation-delay:${Math.min(i*.04,.3)}s">
          ${adminBtns}
          <div class="book-cover" style="background:${bg}">
            ${coverInner}
            ${ribbonTags ? `<div class="book-ribbon">${ribbonTags}</div>` : ''}
            ${reservedOver}
            ${donateBadge}
          </div>
          <div class="book-body">
            <div class="pub-title">${esc(b.title)}</div>
            <div class="pub-author">${esc(b.author)}</div>
            <div class="book-meta">
              ${b.read      ? '<span class="meta-tag" style="background:var(--teal-pale);color:var(--teal-dark);">‚úì lido</span>'      : ''}
              ${b.duplicate ? '<span class="meta-tag" style="background:var(--pink-pale);color:var(--pink-dark);">repetido</span>'     : ''}
              ${b.wishlist  ? '<span class="meta-tag" style="background:var(--blue-pale);color:var(--blue-dark);">wishlist</span>'     : ''}
            </div>
            ${stars ? `<div class="book-rating">${stars}</div>` : ''}
            ${reservedBy}
          </div>
          ${notes}
          ${footer}
        </div>`;
    }).join('');
  }

  // expose edit for inline onclick
  window._editBook = id => { if(isAdmin) openBookModal(id); };

  // ‚îÄ‚îÄ RESERVE ‚îÄ‚îÄ
  window._openReserve = bookId => {
    reservingId = bookId;
    const b  = books.find(b=>b.id===bookId);
    const bg = bgColor(b.title);
    const iconHTML = b.coverUrl
      ? `<img src="${esc(b.coverUrl)}" style="width:52px;height:52px;object-fit:cover;border-radius:6px;">`
      : `<div style="font-size:1.8rem;background:${bg};width:52px;height:52px;border-radius:6px;display:flex;align-items:center;justify-content:center;">${bookEmoji(b.genre)}</div>`;

    document.getElementById('reserve-inner').innerHTML = `
      <div class="modal-header">
        <div><h2>reservar livro</h2><p>seu nome ficar√° vis√≠vel para todos</p></div>
        <button class="modal-close" onclick="window._closeReserve()">‚úï</button>
      </div>
      <div class="modal-book-preview">
        <div class="modal-book-icon">${iconHTML}</div>
        <div>
          <div class="modal-book-title">${esc(b.title)}</div>
          <div class="modal-book-author">${esc(b.author)}</div>
        </div>
      </div>
      <div class="modal-body">
        <div class="form-row">
          <div class="form-group"><label>nome *</label><input type="text" id="r-nome" placeholder="Maria" autocomplete="given-name"></div>
          <div class="form-group"><label>sobrenome *</label><input type="text" id="r-sobre" placeholder="Silva" autocomplete="family-name"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-save" id="btn-confirm-res" onclick="window._confirmReserve()">üíö confirmar reserva</button>
        <button class="btn-cancel-sm" onclick="window._closeReserve()">cancelar</button>
        <p class="privacy-note">üëÅÔ∏è seu nome ser√° exibido publicamente nesta p√°gina</p>
      </div>
    `;
    document.getElementById('reserve-modal').classList.add('show');
    setTimeout(() => document.getElementById('r-nome').focus(), 120);
  };

  window._closeReserve = () => {
    document.getElementById('reserve-modal').classList.remove('show');
    reservingId = null;
  };

  window._confirmReserve = async () => {
    const nome  = document.getElementById('r-nome').value.trim();
    const sobre = document.getElementById('r-sobre').value.trim();
    if (!nome)  { shake('r-nome');  return; }
    if (!sobre) { shake('r-sobre'); return; }

    const btn = document.getElementById('btn-confirm-res');
    btn.disabled = true; btn.textContent = 'salvando...';

    const full = nome + ' ' + sobre;
    const b    = books.find(b=>b.id===reservingId);
    const resData = { name: full, at: new Date().toLocaleDateString('pt-BR'), bookTitle: b.title };

    try {
      if (CONFIGURED) {
        await setDoc(doc(db, 'reservations', reservingId), resData);
      } else {
        reservations[reservingId] = resData;
        saveLocal();
        render();
      }

      document.getElementById('reserve-inner').innerHTML = `
        <div class="success-body">
          <div class="success-icon">üíö</div>
          <h3>reservado!</h3>
          <p><strong>${esc(b.title)}</strong> est√° reservado para <strong style="text-transform:none">${esc(full)}</strong>.<br><br>entre em contato para combinar a retirada!</p>
          <button class="btn-fechar" onclick="window._closeReserve();render();">fechar</button>
        </div>
      `;
    } catch(err) {
      showToast('erro ao reservar. tente novamente.');
      btn.disabled = false; btn.textContent = 'üíö confirmar reserva';
    }
  };

  window._cancelReserve = async id => {
    const r = reservations[id];
    if (!r || !confirm(`cancelar a reserva de ${r.name}?`)) return;

    if (CONFIGURED) {
      await deleteDoc(doc(db, 'reservations', id));
    } else {
      delete reservations[id];
      saveLocal();
      render();
    }
    showToast('reserva cancelada.');
  };

  function shake(id) {
    const el = document.getElementById(id);
    el.style.borderColor = 'var(--pink)';
    el.animate([{transform:'translateX(-5px)'},{transform:'translateX(5px)'},{transform:'translateX(0)'}],{duration:220});
    el.focus();
    setTimeout(() => el.style.borderColor='', 1200);
  }

  // ‚îÄ‚îÄ EVENTS ‚îÄ‚îÄ
  ['pass-modal','book-modal','reserve-modal'].forEach(id => {
    document.getElementById(id).addEventListener('click', e => {
      if (e.target.id === id) {
        if (id==='pass-modal')    window.closePassModal();
        if (id==='book-modal')    window.closeBookModal();
        if (id==='reserve-modal') window._closeReserve();
      }
    });
  });

  document.addEventListener('keydown', e => {
    if (e.key==='Escape') {
      window.closePassModal(); window.closeBookModal(); window._closeReserve();
    }
  });

  document.getElementById('search').addEventListener('input', render);

  // make render accessible for inline calls
  window.render = render;
</script>
</body>
</html>
