<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>livrhanna</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:         #F4F0E4;
    --teal:       #44A194;
    --teal-dark:  #358078;
    --teal-pale:  #d4efec;
    --blue:       #537D96;
    --blue-dark:  #3f617a;
    --blue-pale:  #d6e5ef;
    --pink:       #EC8F8D;
    --pink-dark:  #d4706e;
    --pink-pale:  #fce8e8;
    --ink:        #2a2a2a;
    --mid:        #6b6b6b;
    --light:      #e8e4d8;
    --white:      #ffffff;
    --card-bg:    #faf8f3;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--ink);
    min-height: 100vh;
    font-size: 15px;
    text-transform: lowercase;
  }

  .book-title, .book-author,
  .pub-title,  .pub-author,
  .modal-book-title, .modal-book-author,
  .res-name { text-transform: none !important; }
  input, textarea, select { text-transform: none; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     HERO
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .hero {
    background: var(--teal);
    padding: 48px 36px 36px;
    text-align: center;
    position: relative;
  }

  .logo {
    font-family: 'Playfair Display', serif;
    font-size: 2.8rem; color: var(--white);
    font-style: italic; letter-spacing: -0.01em;
    margin-bottom: 10px; display: block;
    text-transform: lowercase;
  }

  .hero p {
    font-size: .97rem; color: rgba(255,255,255,.75);
    max-width: 460px; margin: 0 auto 24px; line-height: 1.65;
  }

  .hero-search { max-width: 380px; margin: 0 auto; position: relative; }

  .hero-search input {
    width: 100%; padding: 11px 18px 11px 40px;
    border: 2px solid rgba(255,255,255,.22); border-radius: 24px;
    background: rgba(255,255,255,.14); color: white;
    font-family: 'DM Sans', sans-serif; font-size: .93rem;
    transition: all .2s; text-transform: none;
  }

  .hero-search input::placeholder { color: rgba(255,255,255,.48); }
  .hero-search input:focus { outline: none; background: rgba(255,255,255,.22); border-color: rgba(255,255,255,.6); }
  .hero-search::before { content: 'ğŸ”'; position: absolute; left: 13px; top: 50%; transform: translateY(-50%); }

  .hero-stats { display: flex; justify-content: center; gap: 28px; margin-top: 18px; }
  .hstat { font-size: .75rem; color: rgba(255,255,255,.68); }
  .hstat strong { font-family: 'Playfair Display', serif; font-size: 1.25rem; color: var(--white); display: block; line-height: 1.2; }

  /* admin mode toggle â€” hidden dot in hero */
  .admin-toggle {
    position: absolute; bottom: 12px; right: 16px;
    width: 22px; height: 22px; border-radius: 50%;
    background: rgba(255,255,255,.12); border: none;
    cursor: pointer; transition: background .2s;
    display: flex; align-items: center; justify-content: center;
    font-size: .7rem; color: rgba(255,255,255,.4);
  }
  .admin-toggle:hover { background: rgba(255,255,255,.22); color: rgba(255,255,255,.7); }

  /* admin bar â€” shown when logged in */
  .admin-bar {
    display: none;
    background: var(--ink);
    padding: 10px 28px;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    flex-wrap: wrap;
  }

  .admin-bar.visible { display: flex; }

  .admin-bar span {
    font-size: .78rem; color: rgba(255,255,255,.7);
  }

  .admin-bar span strong { color: var(--teal); }

  .admin-bar-actions { display: flex; gap: 8px; align-items: center; }

  .btn-add-book {
    padding: 7px 18px; background: var(--teal); border: none;
    border-radius: 20px; font-family: 'DM Sans', sans-serif;
    font-size: .8rem; font-weight: 700; color: white;
    cursor: pointer; transition: background .2s;
  }

  .btn-add-book:hover { background: var(--teal-dark); }

  .btn-logout {
    padding: 6px 14px; background: transparent;
    border: 1px solid rgba(255,255,255,.2); border-radius: 20px;
    font-size: .75rem; color: rgba(255,255,255,.55);
    cursor: pointer; transition: all .2s; font-family: 'DM Sans', sans-serif;
  }

  .btn-logout:hover { border-color: rgba(255,255,255,.5); color: white; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     BOOK GRID
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .container { max-width: 1100px; margin: 0 auto; padding: 32px 28px; }

  .section-label {
    font-size: .7rem; color: var(--mid); margin-bottom: 18px;
    display: flex; align-items: center; gap: 10px; letter-spacing: .1em;
  }
  .section-label::after { content:''; flex:1; height:1px; background:var(--light); }

  .books-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 18px; }

  .book-card {
    background: var(--white); border-radius: 10px;
    box-shadow: 0 2px 12px rgba(0,0,0,.07);
    overflow: hidden; transition: transform .22s, box-shadow .22s;
    animation: fadeUp .3s ease both;
    display: flex; flex-direction: column;
    border: 1.5px solid var(--light);
    position: relative;
  }

  @keyframes fadeUp { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

  .book-card:hover { transform: translateY(-5px); box-shadow: 0 10px 26px rgba(0,0,0,.12); }
  .book-card.is-reserved { opacity: .72; }
  .book-card.is-reserved:hover { transform: none; box-shadow: 0 2px 12px rgba(0,0,0,.07); }

  /* admin actions overlay on card */
  .card-admin-actions {
    display: none;
    position: absolute; top: 8px; right: 8px;
    gap: 5px; z-index: 10;
  }

  .admin-mode .card-admin-actions { display: flex; }

  .card-btn {
    width: 28px; height: 28px; border-radius: 50%;
    border: none; cursor: pointer; display: flex;
    align-items: center; justify-content: center;
    font-size: .75rem; transition: all .15s;
    box-shadow: 0 1px 4px rgba(0,0,0,.2);
  }

  .card-btn.edit   { background: var(--white); color: var(--blue); }
  .card-btn.delete { background: var(--white); color: var(--pink-dark); }
  .card-btn.edit:hover   { background: var(--blue);     color: white; }
  .card-btn.delete:hover { background: var(--pink-dark); color: white; }

  /* cover */
  .book-cover {
    width: 100%; height: 170px; position: relative; overflow: hidden;
    display: flex; align-items: center; justify-content: center;
    font-size: 3.5rem; background: var(--light); flex-shrink: 0;
  }

  .book-cover img { width:100%; height:100%; object-fit:cover; position:absolute; inset:0; }
  .cover-emoji { position:relative; z-index:1; }

  .reserved-overlay {
    position: absolute; inset: 0; background: rgba(83,125,150,.38);
    display: flex; align-items: center; justify-content: center; z-index: 2;
  }

  .reserved-stamp {
    border: 2.5px solid white; color: white;
    font-family: 'Playfair Display', serif; font-size: .88rem; font-weight: 700;
    padding: 4px 14px; letter-spacing: .1em; transform: rotate(-12deg);
  }

  .book-body { padding: 14px 15px 0; flex: 1; }
  .pub-title  { font-family: 'Playfair Display', serif; font-size: 1rem; font-weight: 700; line-height: 1.35; margin-bottom: 3px; color: var(--ink); }
  .pub-author { font-size: .78rem; color: var(--mid); font-style: italic; margin-bottom: 9px; }
  .pub-tags   { display: flex; flex-wrap: wrap; gap: 3px; margin-bottom: 10px; }

  .tag {
    font-size: .6rem; padding: 2px 7px; border-radius: 10px;
    background: var(--light); color: var(--mid); font-weight: 500;
  }

  .book-rating { color: var(--pink); font-size: .78rem; margin-bottom: 6px; }

  .reserved-by {
    display: flex; align-items: center; gap: 8px;
    background: var(--teal-pale); border-radius: 6px;
    padding: 7px 10px; margin-bottom: 10px;
    font-size: .79rem; color: var(--teal-dark);
  }

  .avatar {
    width: 28px; height: 28px; border-radius: 50%;
    background: var(--teal); color: white;
    display: flex; align-items: center; justify-content: center;
    font-family: 'Playfair Display', serif; font-weight: 700;
    font-size: .82rem; flex-shrink: 0; text-transform: uppercase;
  }

  .res-label { font-size: .67rem; color: var(--teal); display: block; opacity: .75; }

  .book-footer { padding: 0 15px 15px; margin-top: auto; padding-top: 4px; }

  .btn-quero {
    width: 100%; padding: 10px; background: var(--teal); border: none;
    border-radius: 8px; font-family: 'DM Sans', sans-serif; font-size: .92rem;
    font-weight: 700; color: white; cursor: pointer; transition: background .2s;
  }

  .btn-quero:hover { background: var(--teal-dark); }

  .btn-cancelar {
    width: 100%; padding: 7px; background: transparent;
    border: 1.5px solid var(--light); border-radius: 8px;
    font-size: .73rem; color: var(--mid); cursor: pointer;
    transition: all .15s; margin-top: 5px; font-family: 'DM Sans', sans-serif;
  }

  .btn-cancelar:hover { border-color: var(--pink); color: var(--pink-dark); }

  /* book not for donation â€” shown in admin mode only */
  .book-card.not-donate { border-color: var(--light); opacity: .6; }
  .not-donate-label {
    display: none;
    width: 100%; padding: 8px 15px 12px;
    font-size: .7rem; color: var(--mid); text-align: center; font-style: italic;
  }

  .admin-mode .book-card.not-donate { opacity: 1; }
  .admin-mode .not-donate-label { display: block; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     EMPTY
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .empty-state { text-align: center; padding: 70px 20px; color: var(--mid); }
  .empty-state .icon { font-size: 3.5rem; margin-bottom: 14px; }
  .empty-state h3 { font-family: 'Playfair Display', serif; font-size: 1.3rem; margin-bottom: 7px; color: var(--ink); }
  .empty-state p { font-size: .87rem; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODALS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .modal-overlay {
    display: none; position: fixed; inset: 0;
    background: rgba(42,42,42,.55); z-index: 200;
    align-items: center; justify-content: center;
    padding: 20px; backdrop-filter: blur(4px);
  }

  .modal-overlay.show { display: flex; }

  .modal {
    background: var(--bg); border-radius: 14px;
    width: 100%; max-width: 480px; max-height: 92vh;
    overflow-y: auto; box-shadow: 0 24px 60px rgba(0,0,0,.18);
    animation: slideUp .26s cubic-bezier(.22,1,.36,1);
  }

  @keyframes slideUp { from { opacity:0; transform:translateY(24px) scale(.97); } to { opacity:1; transform:translateY(0) scale(1); } }

  .modal-header {
    padding: 20px 22px 14px;
    border-bottom: 1px solid var(--light);
    display: flex; justify-content: space-between; align-items: flex-start;
  }

  .modal-header h2 { font-family: 'Playfair Display', serif; font-size: 1.25rem; color: var(--ink); }
  .modal-header p  { font-size: .77rem; color: var(--mid); margin-top: 2px; }
  .modal-close { background: none; border: none; font-size: 1.2rem; cursor: pointer; color: var(--mid); }

  .modal-book-preview {
    display: flex; align-items: center; gap: 12px;
    padding: 12px 22px; background: var(--light);
    border-bottom: 1px solid rgba(0,0,0,.05);
  }

  .modal-book-icon {
    font-size: 2rem; border-radius: 6px;
    width: 52px; height: 52px; display: flex; align-items: center; justify-content: center;
    overflow: hidden; flex-shrink: 0;
  }

  .modal-book-icon img { width:100%; height:100%; object-fit:cover; border-radius:4px; }
  .modal-book-title  { font-family:'Playfair Display',serif; font-size:.93rem; font-weight:700; color:var(--ink); }
  .modal-book-author { font-size:.76rem; color:var(--mid); font-style:italic; }

  .modal-body { padding: 18px 22px; }

  .form-group { margin-bottom: 13px; }

  .form-group label {
    display: block; font-size: .71rem;
    color: var(--mid); margin-bottom: 5px; font-weight: 700; letter-spacing: .04em;
  }

  .form-group input, .form-group select, .form-group textarea {
    width: 100%; padding: 9px 11px; border: 1.5px solid var(--light); border-radius: 8px;
    background: var(--white); font-family: 'DM Sans', sans-serif; font-size: .87rem;
    color: var(--ink); transition: border-color .2s; text-transform: none;
  }

  .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
    outline: none; border-color: var(--teal);
  }

  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

  .checkbox-group { display: flex; gap: 14px; flex-wrap: wrap; }
  .checkbox-label { display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: .8rem; color: var(--mid); }

  /* cover upload */
  .cover-upload-area {
    border: 2px dashed var(--light); border-radius: 8px;
    padding: 14px; text-align: center; cursor: pointer;
    transition: all .2s; position: relative; overflow: hidden; min-height: 70px;
    display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px;
  }

  .cover-upload-area:hover { border-color: var(--teal); background: var(--teal-pale); }
  .cover-upload-area input { position:absolute; inset:0; opacity:0; cursor:pointer; width:100%; height:100%; }
  .cover-upload-area .upload-icon { font-size: 1.6rem; }
  .cover-upload-area p { font-size: .75rem; color: var(--mid); }
  .cover-upload-area img.cover-preview { width:100%; max-height:130px; object-fit:cover; border-radius:6px; }

  .modal-footer { padding: 4px 22px 20px; }

  .btn-save {
    width: 100%; padding: 11px; background: var(--teal); border: none; border-radius: 8px;
    font-family: 'DM Sans', sans-serif; font-size: .95rem; font-weight: 700; color: white;
    cursor: pointer; transition: background .2s;
  }

  .btn-save:hover { background: var(--teal-dark); }

  .btn-cancel-sm {
    width: 100%; padding: 8px; margin-top: 7px;
    background: transparent; border: 1.5px solid var(--light); border-radius: 8px;
    font-family: 'DM Sans', sans-serif; color: var(--mid);
    cursor: pointer; font-size: .82rem; transition: all .2s;
  }

  .btn-cancel-sm:hover { border-color: var(--mid); }

  .privacy-note { text-align: center; font-size: .7rem; color: var(--mid); margin-top: 8px; font-style: italic; }

  /* success */
  .success-body { padding: 28px 22px 24px; text-align: center; }
  .success-icon { font-size: 3.2rem; margin-bottom: 12px; }
  .success-body h3 { font-family: 'Playfair Display', serif; font-size: 1.3rem; color: var(--teal); margin-bottom: 8px; }
  .success-body p  { font-size: .86rem; color: var(--mid); line-height: 1.6; }

  .btn-fechar {
    margin-top: 18px; padding: 10px 28px;
    background: var(--teal); border: none; border-radius: 8px;
    color: white; font-family: 'DM Sans', sans-serif;
    font-size: .9rem; font-weight: 700; cursor: pointer; transition: background .2s;
  }

  .btn-fechar:hover { background: var(--teal-dark); }

  /* password modal */
  .pass-modal {
    max-width: 360px; padding: 32px 28px; text-align: center;
  }

  .pass-modal h2 { font-family:'Playfair Display',serif; font-size:1.3rem; margin-bottom:6px; }
  .pass-modal p  { font-size:.82rem; color:var(--mid); margin-bottom:20px; }

  .pass-input-wrap { position: relative; margin-bottom: 14px; }
  .pass-input-wrap input { font-size: 1rem; letter-spacing: .1em; text-align: center; padding-right: 40px; }
  .pass-toggle {
    position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
    background: none; border: none; cursor: pointer; font-size: 1rem; color: var(--mid);
  }

  .pass-error { font-size: .78rem; color: var(--pink-dark); margin-bottom: 10px; display: none; }
  .pass-error.visible { display: block; }

  /* â”€â”€ TOAST â”€â”€ */
  .toast {
    position: fixed; bottom: 24px; right: 24px;
    background: var(--ink); color: white;
    padding: 10px 18px; border-radius: 8px; font-size: .86rem;
    transform: translateY(70px); opacity: 0; transition: all .3s;
    z-index: 300; border-left: 3px solid var(--teal); max-width: 280px;
  }

  .toast.show { transform: translateY(0); opacity: 1; }

  /* â”€â”€ RESPONSIVE â”€â”€ */
  @media (max-width: 640px) {
    .hero { padding: 36px 18px 30px; }
    .container { padding: 20px 14px; }
    .books-grid { grid-template-columns: 1fr 1fr; gap: 10px; }
    .form-row { grid-template-columns: 1fr; }
    .hero-stats { gap: 20px; }
    .admin-bar { padding: 10px 18px; }
  }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     HERO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="hero">
  <span class="logo">livrhanna</span>
  <p>escolha um livro que queira levar para casa. clique em <strong style="color:white;">"eu quero!"</strong> e deixe seu nome para reservar.</p>
  <div class="hero-search">
    <input type="text" id="search" placeholder="buscar por tÃ­tulo ou autor..." oninput="render()">
  </div>
  <div class="hero-stats">
    <div class="hstat"><strong id="stat-available">0</strong>disponÃ­veis</div>
    <div class="hstat"><strong id="stat-reserved">0</strong>reservados</div>
  </div>
  <!-- botÃ£o secreto de admin â€” pequeno e discreto no canto -->
  <button class="admin-toggle" onclick="openPasswordModal()" title="">âš™</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ADMIN BAR (visÃ­vel sÃ³ quando logada)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="admin-bar" id="admin-bar">
  <span>âœï¸ modo admin <strong>ativado</strong> â€” somente vocÃª estÃ¡ vendo isso</span>
  <div class="admin-bar-actions">
    <button class="btn-add-book" onclick="openBookModal()">+ adicionar livro</button>
    <button class="btn-logout" onclick="logout()">sair</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     BOOK GRID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="container">
  <div class="section-label" id="section-label">livros disponÃ­veis</div>
  <div class="books-grid" id="books-grid"></div>
  <div class="empty-state" id="empty-state" style="display:none;">
    <div class="icon">ğŸŒ¿</div>
    <h3>nenhum livro encontrado</h3>
    <p>tente buscar por outro tÃ­tulo ou autor.</p>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODAL â€” SENHA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="pass-modal-overlay">
  <div class="modal pass-modal">
    <h2>ğŸ” Ã¡rea restrita</h2>
    <p>digite a senha para entrar no modo admin</p>
    <div class="pass-input-wrap">
      <input type="password" id="pass-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter') checkPassword()">
      <button class="pass-toggle" onclick="togglePassVis()" id="pass-eye">ğŸ‘</button>
    </div>
    <p class="pass-error" id="pass-error">senha incorreta. tente novamente.</p>
    <button class="btn-save" onclick="checkPassword()">entrar</button>
    <button class="btn-cancel-sm" onclick="closePasswordModal()">cancelar</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODAL â€” ADICIONAR / EDITAR LIVRO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="book-modal">
  <div class="modal">
    <div class="modal-header">
      <h2 id="book-modal-title">novo livro</h2>
      <button class="modal-close" onclick="closeBookModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>foto da capa</label>
        <div class="cover-upload-area" id="cover-upload-area">
          <input type="file" accept="image/*" id="cover-file-input" onchange="handleCoverUpload(event)">
          <div id="cover-upload-content">
            <div class="upload-icon">ğŸ“·</div>
            <p>clique para adicionar uma foto</p>
          </div>
        </div>
      </div>
      <div class="form-group"><label>tÃ­tulo *</label><input type="text" id="f-title" placeholder="ex: dom casmurro"></div>
      <div class="form-group"><label>autor *</label><input type="text" id="f-author" placeholder="ex: machado de assis"></div>
      <div class="form-row">
        <div class="form-group">
          <label>gÃªnero</label>
          <select id="f-genre">
            <option value="">selecionar...</option>
            <option>Romance</option><option>FicÃ§Ã£o CientÃ­fica</option><option>Fantasia</option>
            <option>Terror</option><option>MistÃ©rio</option><option>Thriller</option>
            <option>NÃ£o-ficÃ§Ã£o</option><option>Biografia</option><option>HistÃ³ria</option>
            <option>Filosofia</option><option>Autoajuda</option><option>ClÃ¡ssico</option>
            <option>Literatura Brasileira</option><option>Infantil</option>
            <option>HQ / Graphic Novel</option><option>Outro</option>
          </select>
        </div>
        <div class="form-group"><label>ano</label><input type="number" id="f-year" placeholder="ex: 1999" min="1000" max="2100"></div>
      </div>
      <div class="form-group">
        <label>avaliaÃ§Ã£o</label>
        <select id="f-rating">
          <option value="0">sem avaliaÃ§Ã£o</option>
          <option value="1">â­</option><option value="2">â­â­</option>
          <option value="3">â­â­â­</option><option value="4">â­â­â­â­</option>
          <option value="5">â­â­â­â­â­</option>
        </select>
      </div>
      <div class="form-group"><label>observaÃ§Ãµes</label><textarea id="f-notes" rows="2" placeholder="estado do livro, ediÃ§Ã£o especial..."></textarea></div>
      <div class="form-group">
        <label>marcadores</label>
        <div class="checkbox-group">
          <label class="checkbox-label"><input type="checkbox" id="f-donate"> ğŸ’š para doaÃ§Ã£o</label>
          <label class="checkbox-label"><input type="checkbox" id="f-read"> âœ… lido</label>
          <label class="checkbox-label"><input type="checkbox" id="f-duplicate"> ğŸ”´ repetido</label>
          <label class="checkbox-label"><input type="checkbox" id="f-wishlist"> ğŸ”µ wishlist</label>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-save" onclick="saveBook()">salvar livro</button>
      <button class="btn-cancel-sm" onclick="closeBookModal()">cancelar</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODAL â€” RESERVAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="reserve-modal">
  <div class="modal" id="reserve-modal-inner"></div>
</div>

<div class="toast" id="toast"></div>

<script>
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // ğŸ”‘  MUDE A SENHA AQUI
  const ADMIN_PASSWORD = 'livrhanna2025';
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  /* â”€â”€â”€ STATE â”€â”€â”€ */
  let books        = [];
  let reservations = {};
  let isAdmin      = false;
  let editingId    = null;
  let reservingId  = null;
  let pendingCover = null;

  const BG_COLORS = ['#d4efec','#d6e5ef','#fce8e8','#e4d4ef','#d4e8d4','#f0e8d4','#e8d4d4'];
  const EMOJIS    = {'Romance':'ğŸ’•','FicÃ§Ã£o CientÃ­fica':'ğŸš€','Fantasia':'ğŸ§™','Terror':'ğŸ‘»',
    'MistÃ©rio':'ğŸ•µï¸','Thriller':'ğŸ”ª','NÃ£o-ficÃ§Ã£o':'ğŸ“Š','Biografia':'ğŸ‘¤','HistÃ³ria':'ğŸ›ï¸',
    'Filosofia':'ğŸ¤”','Autoajuda':'ğŸ’ª','ClÃ¡ssico':'ğŸ†','Literatura Brasileira':'ğŸŒ¿',
    'Infantil':'ğŸŒˆ','HQ / Graphic Novel':'ğŸ¦¸'};

  /* â”€â”€â”€ STORAGE â”€â”€â”€ */
  function loadData() {
    try { books        = JSON.parse(localStorage.getItem('livrhanna_books')  || '[]'); } catch(e) { books = []; }
    try { reservations = JSON.parse(localStorage.getItem('livrhanna_reservas')|| '{}'); } catch(e) { reservations = {}; }
    if (books.length === 0) seedSamples();
  }

  function saveData() {
    localStorage.setItem('livrhanna_books',   JSON.stringify(books));
    localStorage.setItem('livrhanna_reservas', JSON.stringify(reservations));
  }

  function genId() { return Date.now().toString(36) + Math.random().toString(36).substr(2); }

  /* â”€â”€â”€ HELPERS â”€â”€â”€ */
  function bookEmoji(g)  { return EMOJIS[g] || 'ğŸ“–'; }
  function bookBg(title) { return BG_COLORS[Math.abs((title||'').split('').reduce((s,c)=>s+c.charCodeAt(0),0)) % BG_COLORS.length]; }
  function initials(n)   { return (n||'').trim().split(' ').filter(Boolean).slice(0,2).map(p=>p[0].toUpperCase()).join(''); }
  function esc(s)        { return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

  function showToast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg; t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 2800);
  }

  /* â”€â”€â”€ ADMIN AUTH â”€â”€â”€ */
  function openPasswordModal() {
    if (isAdmin) { logout(); return; }
    document.getElementById('pass-input').value = '';
    document.getElementById('pass-error').classList.remove('visible');
    document.getElementById('pass-modal-overlay').classList.add('show');
    setTimeout(() => document.getElementById('pass-input').focus(), 120);
  }

  function closePasswordModal() {
    document.getElementById('pass-modal-overlay').classList.remove('show');
  }

  function checkPassword() {
    const val = document.getElementById('pass-input').value;
    if (val === ADMIN_PASSWORD) {
      isAdmin = true;
      closePasswordModal();
      document.getElementById('admin-bar').classList.add('visible');
      document.body.classList.add('admin-mode');
      render();
      showToast('modo admin ativado! ğŸ”“');
    } else {
      document.getElementById('pass-error').classList.add('visible');
      document.getElementById('pass-input').value = '';
      document.getElementById('pass-input').focus();
      document.getElementById('pass-input').animate(
        [{transform:'translateX(-6px)'},{transform:'translateX(6px)'},{transform:'translateX(0)'}],
        {duration:240}
      );
    }
  }

  function logout() {
    isAdmin = false;
    document.getElementById('admin-bar').classList.remove('visible');
    document.body.classList.remove('admin-mode');
    render();
    showToast('saiu do modo admin.');
  }

  function togglePassVis() {
    const inp = document.getElementById('pass-input');
    inp.type = inp.type === 'password' ? 'text' : 'password';
  }

  /* â”€â”€â”€ BOOK MODAL â”€â”€â”€ */
  function openBookModal(id) {
    if (!isAdmin) return;
    editingId    = id || null;
    pendingCover = null;
    const b = id ? books.find(b=>b.id===id) : null;

    document.getElementById('book-modal-title').textContent = b ? 'editar livro' : 'novo livro';
    document.getElementById('f-title').value     = b ? b.title      : '';
    document.getElementById('f-author').value    = b ? b.author     : '';
    document.getElementById('f-genre').value     = b ? (b.genre||'')    : '';
    document.getElementById('f-year').value      = b ? (b.year||'')     : '';
    document.getElementById('f-rating').value    = b ? (b.rating||0)    : 0;
    document.getElementById('f-notes').value     = b ? (b.notes||'')    : '';
    document.getElementById('f-donate').checked    = b ? !!b.donate    : true;
    document.getElementById('f-read').checked      = b ? !!b.read      : false;
    document.getElementById('f-duplicate').checked = b ? !!b.duplicate : false;
    document.getElementById('f-wishlist').checked  = b ? !!b.wishlist  : false;

    const area = document.getElementById('cover-upload-content');
    if (b && b.cover) {
      pendingCover = b.cover;
      area.innerHTML = `<img class="cover-preview" src="${b.cover}" alt="capa"><p style="font-size:.72rem;color:var(--teal);margin-top:4px;">âœ“ foto atual â€” clique para trocar</p>`;
    } else {
      area.innerHTML = `<div class="upload-icon">ğŸ“·</div><p>clique para adicionar uma foto</p>`;
    }

    document.getElementById('book-modal').classList.add('show');
    setTimeout(() => document.getElementById('f-title').focus(), 100);
  }

  function closeBookModal() {
    document.getElementById('book-modal').classList.remove('show');
    editingId = pendingCover = null;
  }

  function handleCoverUpload(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => {
      pendingCover = ev.target.result;
      const area = document.getElementById('cover-upload-content');
      area.innerHTML = `<img class="cover-preview" src="${pendingCover}" alt="capa"><p style="font-size:.72rem;color:var(--teal);margin-top:4px;">âœ“ foto carregada â€” clique para trocar</p>`;
    };
    reader.readAsDataURL(file);
  }

  function saveBook() {
    const title  = document.getElementById('f-title').value.trim();
    const author = document.getElementById('f-author').value.trim();
    if (!title)  { showToast('preencha o tÃ­tulo!');  return; }
    if (!author) { showToast('preencha o autor!'); return; }

    const existing = editingId ? books.find(b=>b.id===editingId) : null;
    const book = {
      id:        editingId || genId(),
      title, author,
      genre:     document.getElementById('f-genre').value,
      year:      document.getElementById('f-year').value,
      rating:    parseInt(document.getElementById('f-rating').value),
      notes:     document.getElementById('f-notes').value.trim(),
      donate:    document.getElementById('f-donate').checked,
      read:      document.getElementById('f-read').checked,
      duplicate: document.getElementById('f-duplicate').checked,
      wishlist:  document.getElementById('f-wishlist').checked,
      cover:     pendingCover !== null ? pendingCover : (existing ? existing.cover : null),
      added:     existing ? existing.added : Date.now()
    };

    if (editingId) {
      books[books.findIndex(b=>b.id===editingId)] = book;
      showToast('livro atualizado! âœ“');
    } else {
      books.push(book);
      showToast('livro adicionado! âœ“');
    }

    saveData(); closeBookModal(); render();
  }

  function deleteBook(id) {
    const b = books.find(b=>b.id===id);
    if (!b) return;
    if (!confirm(`remover "${b.title}" da estante?`)) return;
    books = books.filter(b=>b.id!==id);
    delete reservations[id];
    saveData(); render();
    showToast('livro removido.');
  }

  /* â”€â”€â”€ RENDER â”€â”€â”€ */
  function render() {
    const q = (document.getElementById('search').value||'').toLowerCase();

    // in public mode, show only donate books; in admin, show all
    const list = books.filter(b => {
      const matchSearch = !q || b.title.toLowerCase().includes(q) || b.author.toLowerCase().includes(q);
      const matchMode   = isAdmin ? true : b.donate;
      return matchSearch && matchMode;
    });

    const donateBooks = books.filter(b => b.donate);
    document.getElementById('stat-available').textContent = donateBooks.filter(b=>!reservations[b.id]).length;
    document.getElementById('stat-reserved').textContent  = donateBooks.filter(b=> reservations[b.id]).length;

    const grid  = document.getElementById('books-grid');
    const empty = document.getElementById('empty-state');
    const label = document.getElementById('section-label');

    const visibleCount = list.length;
    label.textContent = q
      ? `resultados para "${q}"`
      : isAdmin
        ? `${books.length} livro${books.length!==1?'s':''} no catÃ¡logo`
        : `${donateBooks.length} livro${donateBooks.length!==1?'s':''} disponÃ­veis`;

    if (visibleCount === 0) { grid.innerHTML=''; empty.style.display='block'; return; }
    empty.style.display = 'none';

    grid.innerHTML = list.map((b, i) => {
      const res    = reservations[b.id];
      const bg     = bookBg(b.title);
      const stars  = b.rating ? 'â­'.repeat(b.rating) : '';
      const isDonate = b.donate;

      const coverHTML = b.cover
        ? `<img src="${esc(b.cover)}" alt="${esc(b.title)}">`
        : `<span class="cover-emoji">${bookEmoji(b.genre)}</span>`;

      const reservedHTML = res ? `
        <div class="reserved-overlay">
          <div class="reserved-stamp">reservado</div>
        </div>` : '';

      const reservedByHTML = res ? `
        <div class="reserved-by">
          <div class="avatar">${initials(res.name)}</div>
          <div>
            <span class="res-label">reservado por</span>
            <span class="res-name">${esc(res.name)}</span>
          </div>
        </div>` : '';

      const footerHTML = !isDonate
        ? `<div class="not-donate-label">nÃ£o estÃ¡ na lista de doaÃ§Ã£o</div>`
        : !res
          ? `<div class="book-footer"><button class="btn-quero" onclick="openReserveModal('${b.id}')">ğŸ’š eu quero!</button></div>`
          : `<div class="book-footer"><button class="btn-cancelar" onclick="cancelarReserva('${b.id}')">cancelar reserva</button></div>`;

      const adminActions = `
        <div class="card-admin-actions">
          <button class="card-btn edit"   onclick="openBookModal('${b.id}')" title="editar">âœï¸</button>
          <button class="card-btn delete" onclick="deleteBook('${b.id}')"    title="remover">ğŸ—‘ï¸</button>
        </div>`;

      const cardClass = !isDonate ? 'not-donate' : res ? 'is-reserved' : '';

      return `
        <div class="book-card ${cardClass}" style="animation-delay:${Math.min(i*0.04,0.3)}s">
          ${adminActions}
          <div class="book-cover" style="background:${bg}">
            ${coverHTML}
            ${reservedHTML}
          </div>
          <div class="book-body">
            <div class="pub-title">${esc(b.title)}</div>
            <div class="pub-author">${esc(b.author)}</div>
            <div class="pub-tags">
              ${b.genre?`<span class="tag">${esc(b.genre)}</span>`:''}
              ${b.year?`<span class="tag">${b.year}</span>`:''}
              ${isAdmin&&b.read?'<span class="tag" style="background:var(--teal-pale);color:var(--teal-dark);">âœ“ lido</span>':''}
              ${isAdmin&&b.duplicate?'<span class="tag" style="background:var(--pink-pale);color:var(--pink-dark);">repetido</span>':''}
              ${isAdmin&&b.wishlist?'<span class="tag" style="background:var(--blue-pale);color:var(--blue-dark);">wishlist</span>':''}
            </div>
            ${stars?`<div class="book-rating">${stars}</div>`:''}
            ${reservedByHTML}
          </div>
          ${footerHTML}
        </div>`;
    }).join('');
  }

  /* â”€â”€â”€ RESERVE MODAL â”€â”€â”€ */
  function openReserveModal(bookId) {
    reservingId = bookId;
    const b  = books.find(b=>b.id===bookId);
    const bg = bookBg(b.title);

    const iconHTML = b.cover
      ? `<img src="${esc(b.cover)}" style="width:52px;height:52px;object-fit:cover;border-radius:6px;">`
      : `<div style="font-size:1.8rem;background:${bg};width:52px;height:52px;border-radius:6px;display:flex;align-items:center;justify-content:center;">${bookEmoji(b.genre)}</div>`;

    document.getElementById('reserve-modal-inner').innerHTML = `
      <div class="modal-header">
        <div>
          <h2>reservar livro</h2>
          <p>seu nome ficarÃ¡ visÃ­vel para todos</p>
        </div>
        <button class="modal-close" onclick="closeReserveModal()">âœ•</button>
      </div>
      <div class="modal-book-preview">
        <div class="modal-book-icon">${iconHTML}</div>
        <div>
          <div class="modal-book-title">${esc(b.title)}</div>
          <div class="modal-book-author">${esc(b.author)}</div>
        </div>
      </div>
      <div class="modal-body">
        <div class="form-row">
          <div class="form-group">
            <label>nome *</label>
            <input type="text" id="r-nome" placeholder="Maria" autocomplete="given-name">
          </div>
          <div class="form-group">
            <label>sobrenome *</label>
            <input type="text" id="r-sobrenome" placeholder="Silva" autocomplete="family-name">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-save" onclick="confirmarReserva()">ğŸ’š confirmar reserva</button>
        <button class="btn-cancel-sm" onclick="closeReserveModal()">cancelar</button>
        <p class="privacy-note">ğŸ‘ï¸ seu nome serÃ¡ exibido publicamente nesta pÃ¡gina</p>
      </div>
    `;

    document.getElementById('reserve-modal').classList.add('show');
    setTimeout(() => document.getElementById('r-nome').focus(), 120);
  }

  function closeReserveModal() {
    document.getElementById('reserve-modal').classList.remove('show');
    reservingId = null;
  }

  function confirmarReserva() {
    const nome      = document.getElementById('r-nome').value.trim();
    const sobrenome = document.getElementById('r-sobrenome').value.trim();
    if (!nome)      { shake('r-nome');      return; }
    if (!sobrenome) { shake('r-sobrenome'); return; }

    const fullName = nome + ' ' + sobrenome;
    const b        = books.find(b=>b.id===reservingId);

    reservations[reservingId] = { name: fullName, at: new Date().toLocaleDateString('pt-BR') };
    saveData();

    document.getElementById('reserve-modal-inner').innerHTML = `
      <div class="success-body">
        <div class="success-icon">ğŸ’š</div>
        <h3>reservado!</h3>
        <p><strong>${esc(b.title)}</strong> estÃ¡ reservado para <strong style="text-transform:none">${esc(fullName)}</strong>.<br><br>entre em contato para combinar a retirada!</p>
        <button class="btn-fechar" onclick="closeReserveModal();render();">fechar</button>
      </div>
    `;
    render();
  }

  function cancelarReserva(bookId) {
    const res = reservations[bookId];
    if (!res) return;
    if (!confirm(`cancelar a reserva de ${res.name}?`)) return;
    delete reservations[bookId];
    saveData(); render();
    showToast('reserva cancelada.');
  }

  function shake(id) {
    const el = document.getElementById(id);
    el.style.borderColor = 'var(--pink)';
    el.animate([{transform:'translateX(-5px)'},{transform:'translateX(5px)'},{transform:'translateX(0)'}],{duration:220});
    el.focus();
    setTimeout(() => el.style.borderColor='', 1200);
  }

  /* â”€â”€â”€ SEED â”€â”€â”€ */
  function seedSamples() {
    const s = [
      { title:'O Alquimista',       author:'Paulo Coelho',          genre:'Romance',           year:'1988', rating:3, read:true,  donate:true,  duplicate:false, wishlist:false, notes:'', cover:null },
      { title:'Sapiens',            author:'Yuval Noah Harari',     genre:'NÃ£o-ficÃ§Ã£o',        year:'2011', rating:4, read:true,  donate:true,  duplicate:false, wishlist:false, notes:'', cover:null },
      { title:'A Menina que Roubava Livros', author:'Markus Zusak', genre:'Romance',           year:'2005', rating:5, read:true,  donate:true,  duplicate:false, wishlist:false, notes:'', cover:null },
      { title:'Dom Casmurro',       author:'Machado de Assis',      genre:'ClÃ¡ssico',          year:'1899', rating:5, read:true,  donate:false, duplicate:false, wishlist:false, notes:'', cover:null },
      { title:'1984',               author:'George Orwell',         genre:'FicÃ§Ã£o CientÃ­fica', year:'1949', rating:5, read:false, donate:false, duplicate:false, wishlist:true,  notes:'', cover:null },
    ];
    s.forEach(b => books.push({ id:genId(), added:Date.now(), ...b }));
    saveData();
  }

  /* â”€â”€â”€ EVENTS â”€â”€â”€ */
  document.getElementById('pass-modal-overlay').addEventListener('click', e => {
    if (e.target === document.getElementById('pass-modal-overlay')) closePasswordModal();
  });
  document.getElementById('book-modal').addEventListener('click', e => {
    if (e.target === document.getElementById('book-modal')) closeBookModal();
  });
  document.getElementById('reserve-modal').addEventListener('click', e => {
    if (e.target === document.getElementById('reserve-modal')) closeReserveModal();
  });
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') { closePasswordModal(); closeBookModal(); closeReserveModal(); }
  });

  /* â”€â”€â”€ INIT â”€â”€â”€ */
  loadData();
  render();
</script>
</body>
</html>
